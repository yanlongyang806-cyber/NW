{
#ifdef NO_NORMALMAP
	float3 N_vs = normalize(normal_vs);
#else
	#ifdef NORMAL_PRECALCULATED
		float3 N_vs = %Normal%.xyz;
	#else
		float3 N_vs = normalize(fromTangentSpace(tangent_vs, binormal_vs, normal_vs, %Normal%.xyz));
	#endif
#endif
	float3 vRef = -reflect(view_vs, N_vs); //2 * dot( view_vs, N_vs ) * N_vs - view_vs;
	%Result% = float4(vRef, 1);
}
